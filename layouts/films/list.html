{{ define "head" }}
  {{- partial "head.html" . -}}
  {{- partial "layout/stylesheet.html" "film" -}}
{{ end }}

{{ define "title" }}
{{- partial "title.html" (dict
    "Title" .Title
    "Site" .Site
    "ShowSiteTitle" true
) -}}
{{ end }}

{{ define "main" }}
{{ .Content }}



<div class="people-grid">
  {{/* Sort films alphabetically by title, ignoring "The" prefix */}}
  {{ $films := .Data.Pages }}
  {{ $films = sort $films "Title" }}
  {{ $sorted_films := slice }}
  {{ range $films }}
    {{ $title := .Title }}
    {{ if hasPrefix $title "The " }}
      {{ $title = substr $title 4 }}
    {{ end }}
    {{ $sorted_films = $sorted_films | append (dict "page" . "sort_title" $title) }}
  {{ end }}
  {{ $sorted_films = sort $sorted_films "sort_title" }}
  {{ range $sorted_films }}
    {{ $film := .page }}
          <article class="film-card">
        <div class="film-poster">
          <a href="{{ $film.RelPermalink }}" class="film-poster-link">
                    {{ $film_image := "" }}
          {{ if $film.Params.image }}
            {{ $film_image = $film.Resources.Get $film.Params.image }}
          {{ end }}
          {{ if $film_image }}
            {{ if and $film_image.MediaType (ne $film_image.MediaType.SubType "svg") }}
              {{ $film_image = $film_image.Fit "300x450" }}
            {{ end }}
            <img src="{{ $film_image.RelPermalink }}" alt="{{ $film.Title }} poster" />
          {{ else }}
            {{ $placeholder := resources.Get "images/placeholder-poster.png" }}
            {{ with $placeholder }}
              {{ $thumb := .Fit "300x450" }}
              <img src="{{ $thumb.RelPermalink }}" alt="{{ $film.Title }} poster" class="placeholder-image" />
            {{ end }}
          {{ end }}
        </a>
      </div>
                      <div class="film-info">
          <h3 class="film-title"><a href="{{ $film.RelPermalink }}">{{ $film.Title }}</a></h3>
          <p class="film-team">by <a href="{{ $film.RelPermalink }}">{{ $film.Params.team }}</a></p>
          {{ if $film.Params.screening_groups }}
            <div class="film-groups">
              {{ range $film.Params.screening_groups }}
                {{ $groupName := . }}
                {{ if eq . "group-a" }}{{ $groupName = "Group A" }}{{ end }}
                {{ if eq . "group-b" }}{{ $groupName = "Group B" }}{{ end }}
                {{ if eq . "group-c" }}{{ $groupName = "Group C" }}{{ end }}
                {{ if eq . "group-d" }}{{ $groupName = "Group D" }}{{ end }}
                <span class="group-tag">{{ $groupName }}</span>
              {{ end }}
            </div>
          {{ end }}
          {{ if $film.Params.logline }}
            <p class="film-logline">{{ $film.Params.logline }}</p>
          {{ end }}
        </div>
    </article>
  {{ end }}
</div>



{{ end }}
