{{ define "head" }}
  {{- partial "head.html" . -}}
  {{- partial "layout/stylesheet.html" "events" -}}
{{ end }}

{{ define "title" }}
{{- partial "title.html" (dict
    "Title" .Title
    "Site" .Site
    "Params" .Params
    "ShowSiteTitle" false
) }}
{{ end }}

{{ define "main" -}}
{{- $events := .Pages -}}
{{- $now := now -}}

{{- $currentEvents := slice -}}
{{- $pastEvents := slice -}}
{{- $priorYearEvents := slice -}}

{{- range $events -}}
  {{- $startTime := time.AsTime .Params.event_start -}}
  {{- $endTime := time.AsTime .Params.event_end -}}
  {{- $eventYear := $startTime.Year -}}
  {{- $currentYear := $now.Year -}}
  
  {{- if eq $eventYear $currentYear -}}
    {{- if $endTime.After $now -}}
      {{- $currentEvents = $currentEvents | append . -}}
    {{- else -}}
      {{- $pastEvents = $pastEvents | append . -}}
    {{- end -}}
  {{- else if lt $eventYear $currentYear -}}
    {{- $priorYearEvents = $priorYearEvents | append . -}}
  {{- end -}}
{{- end -}}

{{- $currentEvents = sort $currentEvents ".Params.event_start" "asc" -}}
{{- $pastEvents = sort $pastEvents ".Params.event_start" "desc" -}}
{{- $priorYearEvents = sort $priorYearEvents ".Params.event_start" "desc" -}}

<div class="events">

{{- if $currentEvents -}}
<h2>Upcoming Events</h2>
{{- range $currentEvents -}}
  {{- $startTime := time.AsTime .Params.event_start -}}
  {{- $endTime := time.AsTime .Params.event_end -}}
  {{- $startTimeFormatted := $startTime.Format "2006-01-02T15:04:05-07:00" -}}
  {{- $endTimeFormatted := $endTime.Format "2006-01-02T15:04:05-07:00" -}}

<div class="event-card">
  {{- partial "components/responsive-img.html" (dict
      "ctx" .
      "name" "image"
      "image_mobile" "image_wide"
      "image_desktop" "image_square"
      "resize" "x512"
  ) -}}
<div class="content">
  <div class="header-group">
    <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
    {{- partial "content/event-timespan.html" (dict
        "start_time" $startTime
        "end_time" $endTime
        "plain" false
    ) -}}
  </div>
  {{- if .Summary -}}
    <p class="summary">{{ .Summary }}</p>
  {{- end -}}
</div>
</div>


{{- end -}}
{{- end -}}

{{- if $pastEvents -}}
<h2>Recent Events</h2>
{{- range $pastEvents -}}
  {{- $startTime := time.AsTime .Params.event_start -}}
  {{- $endTime := time.AsTime .Params.event_end -}}
  {{- $startTimeFormatted := $startTime.Format "2006-01-02T15:04:05-07:00" -}}
  {{- $endTimeFormatted := $endTime.Format "2006-01-02T15:04:05-07:00" -}}

<div class="event-card">
  {{- partial "components/responsive-img.html" (dict
      "ctx" .
      "name" "image"
      "image_mobile" "image_wide"
      "image_desktop" "image_square"
      "resize" "x512"
  ) -}}
<div class="content">
  <div class="header-group">
    <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
    {{- partial "content/event-timespan.html" (dict
        "start_time" $startTime
        "end_time" $endTime
        "plain" false
    ) -}}
  </div>
  {{- if .Summary -}}
    <p class="summary">{{ .Summary }}</p>
  {{- end -}}
</div>
</div>


{{- end -}}
{{- end -}}

{{- if $priorYearEvents -}}
<h2>Prior Year Events</h2>
{{- range $priorYearEvents -}}
  {{- $startTime := time.AsTime .Params.event_start -}}
  {{- $endTime := time.AsTime .Params.event_end -}}
  {{- $startTimeFormatted := $startTime.Format "2006-01-02T15:04:05-07:00" -}}
  {{- $endTimeFormatted := $endTime.Format "2006-01-02T15:04:05-07:00" -}}

<div class="event-card">
  {{- partial "components/responsive-img.html" (dict
      "ctx" .
      "name" "image"
      "image_mobile" "image_wide"
      "image_desktop" "image_square"
      "resize" "x512"
  ) -}}
<div class="content">
  <div class="header-group">
    <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
    {{- partial "content/event-timespan.html" (dict
        "start_time" $startTime
        "end_time" $endTime
        "plain" false
    ) -}}
  </div>
  {{- if .Summary -}}
    <p class="summary">{{ .Summary }}</p>
  {{- end -}}
</div>
</div>


{{- end -}}
{{- end -}}

</div>
{{ end }}